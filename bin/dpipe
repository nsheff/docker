#!/bin/sh
# dpipe is for docker runs that run and exit and don't need to live on.

IMAGE="$1"
shift  # Discard the first argument so we can use "$@"

# This is going to populate the output of the 'vols' script (in docker/bin)
# which provides a list of volumes created from the colon-separated string
# VOLUMES="VOL1:VOL2:VOL3" set in .bashrc.

alias dockerrv="docker run `vols`"

docker run --rm -i \
	--user=`id -u` \
	--env="DISPLAY" \
	--network="host" \
	--env "GENOMES" \
	--volume $HOME:$HOME \
	--volume /tmp:/tmp \
	--volume="/etc/group:/etc/group:ro" \
	--volume="/etc/passwd:/etc/passwd:ro" \
	--volume="/etc/shadow:/etc/shadow:ro"  \
	--volume="/etc/sudoers.d:/etc/sudoers.d:ro" \
	--volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \
	--workdir="`pwd`" \
	${IMAGE} "$@"